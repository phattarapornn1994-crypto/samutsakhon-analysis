<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£ & ‡∏ä‡∏∏‡∏°‡∏ä‡∏ô‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô - ‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏≤‡∏Ñ‡∏£</title>

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <style>
    :root {
      --bg-page: #ffffff;
      --bg-card: #ffffff;
      --bg-side: #f8fafc;
      --border-card: #e2e8f0;
      --text-main: #1e293b;
      --text-dim: #64748b;
      --accent: #0ea5e9;
      --radius-lg: 16px;
      --radius-md: 12px;
      --shadow-card: 0 24px 40px rgb(0 0 0 / 0.06);
    }

    body {
      margin: 0;
      background: var(--bg-page);
      color: var(--text-main);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", sans-serif;
      display: grid;
      grid-template-rows: auto 1fr;
      height: 100vh;
    }

    /* ---------- TOP NAV (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤) ---------- */
    header.site-header {
      background: #ffffff;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      flex-wrap: wrap;
      align-items: flex-start;
      justify-content: space-between;
      padding: 12px 16px;
      row-gap: 12px;
    }

    .brand-block {
      display: flex;
      flex-direction: column;
      min-width: 200px;
    }

    .brand-title {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-main);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .brand-sub {
      font-size: 12px;
      color: var(--text-dim);
      line-height: 1.3;
    }

    nav.main-nav {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      column-gap: 12px;
      row-gap: 8px;
      font-size: 13px;
      font-weight: 500;
    }

    nav.main-nav a {
      text-decoration: none;
      color: var(--text-main);
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 6px 10px;
      line-height: 1.2;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    nav.main-nav a span.emoji {
      font-size: 14px;
      line-height: 1;
    }

    nav.main-nav a.active {
      background: #0ea5e9;
      border-color: #0ea5e9;
      color: #fff;
      box-shadow: 0 12px 24px rgb(14 165 233 / 0.35);
    }

    /* ---------- LAYOUT MAIN ---------- */
    main.page {
      display: grid;
      grid-template-columns: 2fr 1fr;
      height: calc(100vh - 64px); /* minus header height approx */
      max-height: calc(100vh - 64px);
      overflow: hidden;
    }

    /* ‡∏ã‡πâ‡∏≤‡∏¢ = ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà */
    .map-area-wrapper {
      position: relative;
      border-right: 1px solid var(--border-card);
      background: #fff;
      display: flex;
      flex-direction: column;
      min-width: 0;
    }

    .section-head {
      padding: 16px;
      border-bottom: 1px solid var(--border-card);
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: flex-start;
      row-gap: 8px;
    }

    .section-head-left h1 {
      margin: 0;
      font-size: 16px;
      font-weight: 600;
      color: var(--text-main);
      display: flex;
      align-items: center;
      gap: 8px;
      line-height: 1.3;
    }
    .section-head-left .hint {
      font-size: 12px;
      color: var(--text-dim);
      line-height: 1.4;
      margin-top: 4px;
    }

    .map-legend-card {
      border: 1px solid var(--border-card);
      background: #ffffff;
      border-radius: var(--radius-md);
      font-size: 12px;
      line-height: 1.4;
      color: var(--text-main);
      padding: 10px 12px;
      box-shadow: var(--shadow-card);
      max-width: 220px;
    }

    .map-legend-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }
    .dot-pop {
      width: 16px;
      height: 16px;
      border-radius: 999px;
      border: 2px solid #fff;
      box-shadow: 0 8px 16px rgb(0 0 0 / 0.2);
      background: radial-gradient(circle at 30% 30%, #fb923c 0%, #ea580c 70%);
    }

    #map {
      flex: 1;
      min-height: 300px;
    }

    /* ---------- PANEL ‡∏Ç‡∏ß‡∏≤ ---------- */
    aside.side-panel {
      background: var(--bg-side);
      display: flex;
      flex-direction: column;
      min-width: 0;
      overflow-y: auto;
      padding: 16px;
      row-gap: 16px;
    }

    .panel-block {
      background: var(--bg-card);
      border: 1px solid var(--border-card);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-card);
      padding: 16px 20px;
      font-size: 13px;
      color: var(--text-main);
      line-height: 1.5;
    }

    .panel-head {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 10px;
    }

    .panel-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-main);
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 8px;
      line-height: 1.4;
    }

    .tag-pop {
      font-size: 11px;
      font-weight: 500;
      background: #fff7ed;
      color: #c2410c;
      border: 1px solid #fdba74;
      padding: 2px 6px;
      border-radius: 6px;
      line-height: 1.2;
    }

    .panel-body {
      font-size: 13px;
      color: var(--text-main);
    }

    .stat-row {
      display: grid;
      grid-template-columns: auto 1fr;
      column-gap: 8px;
      row-gap: 4px;
      font-size: 13px;
      margin-bottom: 8px;
    }
    .stat-label {
      color: var(--text-dim);
      white-space: nowrap;
    }
    .stat-value {
      color: var(--text-main);
      font-weight: 500;
    }

    .toplist {
      font-size: 13px;
      line-height: 1.4;
      margin: 0;
      padding-left: 16px;
      color: var(--text-main);
    }
    .toplist li {
      margin-bottom: 6px;
    }
    .toplist strong {
      color: var(--text-main);
      font-weight: 600;
    }

    .risk-badge {
      font-size: 12px;
      font-weight: 600;
      line-height: 1.2;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      background: #ecfccb;
      border: 1px solid #84cc16;
      color: #4d7c0f;
      border-radius: 6px;
      padding: 4px 6px;
    }

    .note-dim {
      font-size: 12px;
      color: var(--text-dim);
      line-height: 1.4;
      margin-top: 8px;
    }

    /* -------- popup style override leaflet -------- */
    .leaflet-popup-content-wrapper {
      border-radius: 12px;
      border: 1px solid #e2e8f0;
      box-shadow: 0 24px 40px rgb(0 0 0 / .25);
    }
    .leaflet-popup-content {
      margin: 12px 16px;
      font-size: 13px;
      line-height: 1.4;
      color: #1e293b;
    }
    .popup-title {
      font-size: 14px;
      font-weight: 600;
      color: #111827;
      margin-bottom: 4px;
      line-height: 1.4;
    }
    .popup-desc-line {
      font-size: 12px;
      color: #475569;
      line-height: 1.4;
    }

    /* scrollbar nice */
    aside.side-panel::-webkit-scrollbar {
      width: 6px;
    }
    aside.side-panel::-webkit-scrollbar-track {
      background: #e2e8f0;
      border-radius: 999px;
    }
    aside.side-panel::-webkit-scrollbar-thumb {
      background: #94a3b8;
      border-radius: 999px;
    }

    @media (max-width: 900px) {
      main.page {
        grid-template-columns: 1fr;
        grid-template-rows: auto auto;
        height: auto;
        max-height: none;
      }
      .map-area-wrapper {
        border-right: none;
        border-bottom: 1px solid var(--border-card);
        height: 60vh;
        max-height: 480px;
      }
      aside.side-panel {
        height: auto;
        max-height: none;
      }
    }
  </style>
</head>
<body>

  <!-- HEADER / NAV -->
  <header class="site-header">
    <div class="brand-block">
      <div class="brand-title">
        <span>üìä ‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏≤‡∏Ñ‡∏£ Spatial Intelligence</span>
      </div>
      <div class="brand-sub">
        ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ä‡∏∏‡∏°‡∏ä‡∏ô‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô / ‡∏ú‡∏π‡πâ‡∏ú‡∏•‡∏¥‡∏ï / ‡πÇ‡∏•‡∏à‡∏¥‡∏™‡∏ï‡∏¥‡∏Å‡∏™‡πå ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏£‡∏µ‡πÑ‡∏ã‡πÄ‡∏Ñ‡∏¥‡∏•
      </div>
    </div>

    <nav class="main-nav">
      <a href="index.html"><span class="emoji">üè†</span><span>‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</span></a>
      <a href="map.html"><span class="emoji">üó∫Ô∏è</span><span>‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</span></a>
      <a href="competition.html"><span class="emoji">‚öîÔ∏è</span><span>‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á&‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</span></a>
      <a href="logistics.html"><span class="emoji">üöö</span><span>‡∏Å‡∏≤‡∏£‡∏Ç‡∏ô‡∏™‡πà‡∏á</span></a>
      <a href="population.html" class="active"><span class="emoji">üë•</span><span>‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£</span></a>
      <a href="supply.html"><span class="emoji">‚ôªÔ∏è</span><span>‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span></a>
      <a href="capacity.html"><span class="emoji">üè≠</span><span>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</span></a>
      <a href="risk.html"><span class="emoji">üö®</span><span>‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á</span></a>
    </nav>
  </header>

  <main class="page">
    <!-- MAP SIDE -->
    <section class="map-area-wrapper">
      <div class="section-head">
        <div class="section-head-left">
          <h1>
            <span>üë• ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£‡∏ï‡∏≤‡∏°‡∏ï‡∏≥‡∏ö‡∏•</span>
          </h1>
          <div class="hint">
            ‡∏ß‡∏á‡∏Å‡∏•‡∏°‡πÉ‡∏´‡∏ç‡πà/‡∏™‡πâ‡∏°‡πÄ‡∏Ç‡πâ‡∏° = ‡∏Ñ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô (‡∏ê‡∏≤‡∏ô‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô / ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏£‡∏µ‡πÑ‡∏ã‡πÄ‡∏Ñ‡∏¥‡∏•‡∏Å‡∏•‡∏±‡∏ö)
          </div>
        </div>

        <div class="map-legend-card">
          <div class="map-legend-row">
            <div class="dot-pop"></div>
            <div>
              ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô‡∏ä‡∏∏‡∏°‡∏ä‡∏ô / ‡∏Ñ‡∏ô‡∏ß‡∏±‡∏¢‡∏ó‡∏≥‡∏á‡∏≤‡∏ô<br/>
              (‡∏Ç‡∏ô‡∏≤‡∏î = ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£‡∏ï‡∏≥‡∏ö‡∏•)
            </div>
          </div>
          <div class="map-legend-row" style="margin-bottom:0;">
            <div style="font-size:11px;color:#64748b;line-height:1.4;">
              ‡πÅ‡∏ï‡∏∞‡∏à‡∏∏‡∏î‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏≥‡πÄ‡∏†‡∏≠-‡∏ï‡∏≥‡∏ö‡∏•, ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£
            </div>
          </div>
        </div>
      </div>

      <div id="map"></div>
    </section>

    <!-- ANALYSIS SIDE -->
    <aside class="side-panel" id="sidePanel">
      <!-- ‡∏ö‡∏•‡πá‡∏≠‡∏Ñ‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° -->
      <section class="panel-block" id="panel-overview">
        <div class="panel-head">
          <div class="panel-title">
            <span>üë• ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£</span>
            <span class="tag-pop">‡∏ê‡∏≤‡∏ô‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏Å</span>
          </div>
        </div>
        <div class="panel-body" id="overviewBody">
          <div class="stat-row">
            <div class="stat-label">‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£‡∏£‡∏ß‡∏° (‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì)</div>
            <div class="stat-value" id="totalPop">-</div>
          </div>
          <div class="stat-row">
            <div class="stat-label">‡∏ï‡∏≥‡∏ö‡∏•‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞‡∏™‡∏∏‡∏î</div>
            <div class="stat-value" id="maxTambon">-</div>
          </div>
          <div class="stat-row">
            <div class="stat-label">Top ‡πÇ‡∏ã‡∏ô‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô</div>
            <div class="stat-value" id="topZonesShort">-</div>
          </div>

          <div class="note-dim">
            ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏∏‡∏Å‡∏ï‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô = ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏±‡πâ‡∏á‡∏à‡∏∏‡∏î‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏™‡∏î‡∏∏ / ‡∏Ñ‡∏±‡∏î‡πÅ‡∏¢‡∏Å / ‡∏≠‡∏±‡∏î‡∏Å‡πâ‡∏≠‡∏ô‡πÑ‡∏î‡πâ
            ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏∂‡∏á‡∏Ñ‡∏ô‡∏à‡∏≤‡∏Å‡πÑ‡∏Å‡∏•‡∏°‡∏≤‡∏Å
          </div>
        </div>
      </section>

      <!-- ‡∏ö‡∏•‡πá‡∏≠‡∏Ñ Top ‡∏ï‡∏≥‡∏ö‡∏• -->
      <section class="panel-block">
        <div class="panel-head">
          <div class="panel-title">
            <span>üèòÔ∏è ‡∏ï‡∏≥‡∏ö‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏¢‡∏≠‡∏∞ (Top 5)</span>
          </div>
          <div class="risk-badge" id="riskBadge">
            üü¢ ‡∏®‡∏±‡∏Å‡∏¢‡∏†‡∏≤‡∏û‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏™‡∏π‡∏á
          </div>
        </div>

        <div class="panel-body">
          <ol class="toplist" id="topList">
            <!-- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢ JS -->
          </ol>

          <div class="note-dim">
            ‡∏ï‡∏≥‡∏ö‡∏•‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£‡∏™‡∏π‡∏á = ‡∏°‡∏µ‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô/‡∏ä‡∏∏‡∏°‡∏ä‡∏ô‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô ‚Üí ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏£‡∏±‡∏ö‡∏ã‡∏∑‡πâ‡∏≠‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏£‡∏µ‡πÑ‡∏ã‡πÄ‡∏Ñ‡∏¥‡∏•‡∏£‡∏≤‡∏¢‡∏¢‡πà‡∏≠‡∏¢‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢
            (PET, ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏•‡∏π‡∏Å‡∏ü‡∏π‡∏Å, ‡∏Å‡∏£‡∏∞‡∏õ‡πã‡∏≠‡∏á ‡∏Ø‡∏•‡∏Ø)
          </div>
        </div>
      </section>

      <!-- ‡∏ö‡∏•‡πá‡∏≠‡∏Ñ‡πÄ‡∏ä‡∏¥‡∏á‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå -->
      <section class="panel-block">
        <div class="panel-head">
          <div class="panel-title">
            <span>üì¶ ‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡πÄ‡∏ä‡∏¥‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£</span>
          </div>
        </div>
        <div class="panel-body" id="bizInsight">
          ‚Ä¢ ‡πÇ‡∏ã‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞‡πÅ‡∏•‡∏∞‡∏≠‡∏¢‡∏π‡πà‡πÑ‡∏°‡πà‡πÑ‡∏Å‡∏•‡∏ê‡∏≤‡∏ô‡πÄ‡∏£‡∏≤ = ‡∏à‡∏∏‡∏î‡∏£‡∏±‡∏ö‡∏ã‡∏∑‡πâ‡∏≠‡∏´‡∏•‡∏±‡∏Å / ‡∏à‡∏∏‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏ó‡∏µ‡∏°‡∏Ñ‡∏±‡∏î‡πÅ‡∏¢‡∏Å‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô<br/><br/>
          ‚Ä¢ ‡πÇ‡∏ã‡∏ô‡∏Ñ‡∏ô‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô‡∏°‡∏≤‡∏Å & ‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡πÅ‡∏´‡πà‡∏á (‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤ "‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤")
          = ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏£‡∏µ‡πÑ‡∏ã‡πÄ‡∏Ñ‡∏¥‡∏•‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÅ‡∏Ñ‡πà‡∏ï‡∏≤‡∏°‡∏£‡∏≠‡∏ö‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•<br/><br/>
          ‚Ä¢ ‡∏ñ‡πâ‡∏≤‡∏ä‡∏∏‡∏°‡∏ä‡∏ô‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ï‡∏≥‡∏ö‡∏•‡∏≠‡∏∏‡∏ï‡∏™‡∏≤‡∏´‡∏Å‡∏£‡∏£‡∏°
          ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏´‡∏≤‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡πâ‡∏ô‡πÄ‡∏Ñ‡∏¢‡∏á‡∏≤‡∏ô‡∏¢‡∏Å/‡∏≠‡∏±‡∏î/‡∏Ñ‡∏±‡∏î ‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢
          ‚Üí ‡∏•‡∏î‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏®‡∏π‡∏ô‡∏¢‡πå
        </div>
      </section>
    </aside>
  </main>

  <script>
    // -------------------------------------------------
    // 1) ‡∏ä‡∏µ‡πâ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤ (‡∏•‡∏≤‡∏ô‡∏Å‡∏£‡∏∞‡∏ó‡∏¥‡∏á‡πÅ‡∏î‡∏á)
    //    ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏∞‡∏¢‡∏∞/‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ñ‡πà‡∏ß‡∏á‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï
    // -------------------------------------------------
    const HUB_POINT = {
      name: "‡∏à‡∏∏‡∏î‡∏•‡∏≤‡∏ô‡∏Å‡∏£‡∏∞‡∏ó‡∏¥‡∏á‡πÅ‡∏î‡∏á (‡∏ê‡∏≤‡∏ô‡πÄ‡∏£‡∏≤)",
      lat: 13.565126,
      lng: 100.279895
    };

    // -------------------------------------------------
    // 2) ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà Leaflet
    // -------------------------------------------------
    const street = L.tileLayer(
      "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
      {
        maxZoom: 19,
        attribution: "&copy; OpenStreetMap contributors"
      }
    );

    const map = L.map("map", {
      center: [13.58, 100.28],
      zoom: 11,
      layers: [street]
    });

    // group marker
    const populationLayer = L.layerGroup().addTo(map);

    // ‡∏à‡∏∏‡∏î HUB (‡∏®‡∏π‡∏ô‡∏¢‡πå‡πÄ‡∏£‡∏≤)
    const hubMarker = L.circleMarker([HUB_POINT.lat, HUB_POINT.lng], {
      radius: 8,
      color: "#0ea5e9",
      weight: 2,
      fillColor: "#0ea5e9",
      fillOpacity: 0.9
    }).bindPopup(`
      <div class="popup-title">üö© ${HUB_POINT.name}</div>
      <div class="popup-desc-line">‡∏û‡∏¥‡∏Å‡∏±‡∏î: ${HUB_POINT.lat.toFixed(5)}, ${HUB_POINT.lng.toFixed(5)}</div>
      <div class="popup-desc-line">‡∏ê‡∏≤‡∏ô‡πÇ‡∏•‡∏à‡∏¥‡∏™‡∏ï‡∏¥‡∏Å‡∏™‡πå‡∏´‡∏•‡∏±‡∏Å</div>
    `);
    hubMarker.addTo(populationLayer);

    // -------------------------------------------------
    // 3) ‡∏≠‡πà‡∏≤‡∏ô CSV ‡∏ï‡∏≥‡∏ö‡∏•
    //    ‡∏ü‡∏≠‡∏£‡πå‡πÅ‡∏°‡∏ï:
    //    ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠,‡∏ï‡∏≥‡∏ö‡∏•_TH,‡∏ï‡∏≥‡∏ö‡∏•_ENG,‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£,‡∏û‡∏¥‡∏Å‡∏±‡∏î
    // -------------------------------------------------
    function parseSubdistrictCSV(csvText) {
      const lines = csvText.trim().split("\n");
      const out = [];

      // ‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏ä‡πá‡∏Ñ header
      const header = lines[0].split(",");
      const looksHeader =
        header[0].includes("‡∏≠‡∏≥‡πÄ‡∏†‡∏≠") ||
        header[1].includes("‡∏ï‡∏≥‡∏ö‡∏•") ||
        header[3].includes("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô");

      for (let i = looksHeader ? 1 : 0; i < lines.length; i++) {
        const row = lines[i].trim();
        if (!row) continue;

        // ‡∏£‡∏∞‡∏ß‡∏±‡∏á address ‡∏´‡∏£‡∏∑‡∏≠ comma ‡πÉ‡∏ô lat,lng
        // ‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ö‡∏ö:
        // ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏≤‡∏Ñ‡∏£,‡∏°‡∏´‡∏≤‡∏ä‡∏±‡∏¢,Maha Chai,38,607,13.5497804, 100.274131
        // -> ‡∏°‡∏µ‡∏à‡∏∏‡∏•‡∏†‡∏≤‡∏Ñ (,) ‡πÉ‡∏ô "38,607"
        // ‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏≠‡∏°‡∏°‡∏≤
        // ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á: split ‡πÇ‡∏î‡∏¢ comma ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏¢‡πá‡∏ö‡∏Å‡∏•‡∏±‡∏ö

        // ‡∏•‡∏≠‡∏á split ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß
        let rawParts = row.split(",");
        // ‡πÄ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö:
        // 0: ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠
        // 1: ‡∏ï‡∏≥‡∏ö‡∏•_TH
        // 2: ‡∏ï‡∏≥‡∏ö‡∏•_ENG
        // 3+: ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£ (‡∏≠‡∏≤‡∏à‡∏°‡∏µ , )
        // last-1, last: lat, lng

        if (rawParts.length < 6) continue;

        const amphur = rawParts[0].trim();
        const tambonTH = rawParts[1].trim();
        const tambonEN = rawParts[2].trim();

        // lat = second last number
        const lat = parseFloat(rawParts[rawParts.length - 2]);
        const lng = parseFloat(rawParts[rawParts.length - 1]);

        // join ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£
        const popParts = rawParts.slice(3, rawParts.length - 2);
        const popStr = popParts.join("").trim(); // ‡πÄ‡∏≠‡∏≤‡∏Ñ‡∏≠‡∏°‡∏°‡∏≤‡∏≠‡∏≠‡∏Å
        const population = parseInt(popStr.replace(/[^0-9]/g, ""), 10);

        if (isNaN(lat) || isNaN(lng) || isNaN(population)) {
          continue;
        }

        out.push({
          amphur,
          tambonTH,
          tambonEN,
          population,
          lat,
          lng
        });
      }

      return out;
    }

    // -------------------------------------------------
    // 4) helper: ‡∏™‡∏µ/‡∏Ç‡∏ô‡∏≤‡∏î‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£
    // -------------------------------------------------
    function getCircleStyle(pop, maxPop) {
      // scale radius 6px ‚Üí 28px ‡πÅ‡∏ö‡∏ö nonlinear ‡∏´‡∏ô‡πà‡∏≠‡∏¢
      const rMin = 6;
      const rMax = 28;
      const scale = Math.sqrt(pop / maxPop); // ‡∏ö‡∏ß‡∏°‡∏ä‡πâ‡∏≤‡∏•‡∏á
      const radius = rMin + (rMax - rMin) * scale;

      // gradient ‡∏™‡πâ‡∏°‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£‡πÄ‡∏¢‡∏≠‡∏∞
      // popRatio ~0..1
      const popRatio = pop / maxPop;
      // baseColor: ‡πÑ‡∏•‡πà‡∏à‡∏≤‡∏Å‡∏™‡πâ‡∏°‡∏≠‡πà‡∏≠‡∏ô -> ‡∏™‡πâ‡∏°‡πÄ‡∏Ç‡πâ‡∏°
      // ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏™‡∏µ‡∏î‡πâ‡∏ß‡∏¢‡∏™‡∏π‡∏ï‡∏£‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô ‡πÄ‡∏≠‡∏≤‡∏á‡πà‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏á‡∏ó‡∏µ‡πà:
      const fillColor = popRatio > 0.7
        ? "#ea580c"
        : popRatio > 0.4
        ? "#f97316"
        : "#fdba74";

      return {
        radius,
        color: "#ffffff",
        weight: 1.5,
        fillColor,
        fillOpacity: 0.9
      };
    }

    // -------------------------------------------------
    // 5) render markers + ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ç‡∏ß‡∏≤
    // -------------------------------------------------
    function renderPopulationMap(data) {
      // max / total
      let totalPop = 0;
      let maxPop = 0;
      let maxTambonObj = null;

      data.forEach(d => {
        totalPop += d.population;
        if (d.population > maxPop) {
          maxPop = d.population;
          maxTambonObj = d;
        }
      });

      // ‡∏ß‡∏≤‡∏á‡∏´‡∏°‡∏∏‡∏î
      const bounds = [];
      data.forEach(d => {
        const style = getCircleStyle(d.population, maxPop);
        const marker = L.circleMarker([d.lat, d.lng], style).bindPopup(`
          <div class="popup-title">${d.tambonTH} (${d.tambonEN})</div>
          <div class="popup-desc-line"><strong>‡∏≠‡∏≥‡πÄ‡∏†‡∏≠:</strong> ${d.amphur}</div>
          <div class="popup-desc-line"><strong>‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£:</strong> ${d.population.toLocaleString("th-TH")} ‡∏Ñ‡∏ô</div>
          <div class="popup-desc-line">‡∏û‡∏¥‡∏Å‡∏±‡∏î: ${d.lat.toFixed(4)}, ${d.lng.toFixed(4)}</div>
        `);
        marker.addTo(populationLayer);
        bounds.push([d.lat, d.lng]);
      });

      // ‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ö HUB ‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏Ñ‡∏£‡∏≠‡∏ö
      bounds.push([HUB_POINT.lat, HUB_POINT.lng]);
      map.fitBounds(bounds, { padding: [40, 40] });

      // ---------- PANEL ‡∏Ç‡∏ß‡∏≤ ----------
      // ‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°
      const totalPopEl = document.getElementById("totalPop");
      const maxTambonEl = document.getElementById("maxTambon");
      const topZonesShortEl = document.getElementById("topZonesShort");

      totalPopEl.textContent = totalPop.toLocaleString("th-TH") + " ‡∏Ñ‡∏ô";

      if (maxTambonObj) {
        maxTambonEl.textContent =
          maxTambonObj.tambonTH +
          " (" +
          maxTambonObj.amphur +
          ") ~ " +
          maxTambonObj.population.toLocaleString("th-TH") +
          " ‡∏Ñ‡∏ô";
      } else {
        maxTambonEl.textContent = "-";
      }

      // TOP 5 ‡∏ï‡∏≥‡∏ö‡∏•‡∏Ñ‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞
      const sorted = data.slice().sort((a,b) => b.population - a.population);
      const top5 = sorted.slice(0,5);

      const topListEl = document.getElementById("topList");
      topListEl.innerHTML = "";
      top5.forEach((d, idx) => {
        const li = document.createElement("li");
        li.innerHTML = `
          <strong>${idx+1}. ${d.tambonTH}</strong> (${d.amphur})<br/>
          ${d.population.toLocaleString("th-TH")} ‡∏Ñ‡∏ô
        `;
        topListEl.appendChild(li);
      });

      // ‡∏ó‡∏≥ short summary 2 ‡∏ï‡∏≥‡∏ö‡∏•‡πÅ‡∏£‡∏Å
      const top2names = top5.slice(0,2).map(d => d.tambonTH);
      topZonesShortEl.textContent = top2names.join(", ");

      // badge ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô
      const riskBadgeEl = document.getElementById("riskBadge");
      // heuristic: ‡∏ñ‡πâ‡∏≤‡∏ï‡∏≥‡∏ö‡∏•‡πÅ‡∏£‡∏Å > 30k ‡∏Ñ‡∏ô ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏π‡∏á
      if (top5.length && top5[0].population >= 30000) {
        riskBadgeEl.textContent = "üü¢ ‡∏®‡∏±‡∏Å‡∏¢‡∏†‡∏≤‡∏û‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏™‡∏π‡∏á";
        riskBadgeEl.style.background = "#ecfccb";
        riskBadgeEl.style.borderColor = "#84cc16";
        riskBadgeEl.style.color = "#4d7c0f";
      } else if (top5.length && top5[0].population >= 15000) {
        riskBadgeEl.textContent = "üü° ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á";
        riskBadgeEl.style.background = "#fefce8";
        riskBadgeEl.style.borderColor = "#fde047";
        riskBadgeEl.style.color = "#854d0e";
      } else {
        riskBadgeEl.textContent = "üî¥ ‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡∏ö‡∏≤‡∏á";
        riskBadgeEl.style.background = "#fee2e2";
        riskBadgeEl.style.borderColor = "#ef4444";
        riskBadgeEl.style.color = "#991b1b";
      }
    }

    // -------------------------------------------------
    // 6) ‡πÇ‡∏´‡∏•‡∏î CSV ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
    // -------------------------------------------------
    fetch("data/subdistricts.csv", { cache: "no-store" })
      .then(res => res.text())
      .then(csvText => {
        const data = parseSubdistrictCSV(csvText);
        renderPopulationMap(data);
      })
      .catch(err => {
        console.error("‡πÇ‡∏´‡∏•‡∏î subdistricts.csv ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ:", err);
        alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£‡πÑ‡∏î‡πâ");
      });

  </script>
</body>
</html>
