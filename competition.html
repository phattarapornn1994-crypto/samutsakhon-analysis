<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á & ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡∏£‡∏∞‡∏¢‡∏∞‡∏£‡∏±‡∏®‡∏°‡∏µ)</title>

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <style>
    :root {
      --bg-page: #ffffff;
      --bg-card: #ffffff;
      --bg-side: #f8fafc;
      --border-card: #e2e8f0;
      --text-main: #1e293b;
      --text-dim: #64748b;
      --accent: #0ea5e9;
      --radius-lg: 16px;
      --radius-md: 12px;
      --shadow-card: 0 24px 40px rgb(0 0 0 / 0.06);

      --recycle-color: #ef4444;     /* ‡πÅ‡∏î‡∏á */
      --liquor-color:  #8b5cf6;     /* ‡∏°‡πà‡∏ß‡∏á */
      --other-color:   #3b82f6;     /* ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô */
      --hub-color:     #f97316;     /* ‡∏™‡πâ‡∏° */
    }

    body {
      margin: 0;
      background: var(--bg-page);
      color: var(--text-main);
      font-family:
        system-ui,
        -apple-system,
        BlinkMacSystemFont,
        "Segoe UI",
        Roboto,
        "Helvetica Neue",
        sans-serif;
      display: grid;
      grid-template-rows: auto 1fr;
      height: 100vh;
    }

    /* ---------- TOP NAV (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà) ---------- */
    header.site-header {
      background: #ffffff;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      flex-wrap: wrap;
      align-items: flex-start;
      justify-content: space-between;
      padding: 12px 16px;
      row-gap: 12px;
    }

    .brand-block {
      display: flex;
      flex-direction: column;
      min-width: 200px;
    }

    .brand-title {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-main);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .brand-sub {
      font-size: 12px;
      color: var(--text-dim);
      line-height: 1.3;
    }

    nav.main-nav {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      column-gap: 12px;
      row-gap: 8px;
      font-size: 13px;
      font-weight: 500;
    }

    nav.main-nav a {
      text-decoration: none;
      color: var(--text-main);
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 6px 10px;
      line-height: 1.2;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    nav.main-nav a span.emoji {
      font-size: 16px;
      line-height: 1;
    }
    nav.main-nav a.active {
      background: #0ea5e9;
      border-color: #0ea5e9;
      color: #fff;
      box-shadow: 0 12px 24px rgb(14 165 233 / 0.35);
    }

    /* ---------- PAGE LAYOUT: 2 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå ---------- */
    main.page {
      display: grid;
      grid-template-columns: 2fr 1fr;
      height: calc(100vh - 64px);
      max-height: calc(100vh - 64px);
      overflow: hidden;
    }

    section.map-area {
      background: #fff;
      border-right: 1px solid var(--border-card);
      display: flex;
      min-width: 0;
      flex-direction: column;
      overflow: hidden;
    }

    aside.side-panel {
      background: var(--bg-side);
      display: flex;
      flex-direction: column;
      min-width: 0;
      overflow-y: auto;
      padding: 16px;
      row-gap: 16px;
    }

    /* ---------- MAP WRAPPER ---------- */
    .map-head {
      padding: 16px;
      border-bottom: 1px solid var(--border-card);
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: flex-start;
      row-gap: 8px;
    }
    .map-head-left h1 {
      margin: 0;
      font-size: 16px;
      font-weight: 600;
      color: var(--text-main);
      display: flex;
      align-items: center;
      gap: 8px;
      line-height: 1.3;
    }
    .map-head-left .hint {
      font-size: 12px;
      color: var(--text-dim);
      line-height: 1.4;
      margin-top: 4px;
    }

    .map-wrapper {
      position: relative;
      flex: 1;
      min-height: 300px;
    }

    #map {
      position: absolute;
      inset: 0;
    }

    /* ---------- PANEL / CARD STYLE ---------- */
    .panel-card {
      background: var(--bg-card);
      border: 1px solid var(--border-card);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-card);
      padding: 16px 20px;
      font-size: 13px;
      color: var(--text-main);
      line-height: 1.5;
    }

    .panel-head {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .panel-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-main);
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 8px;
      line-height: 1.4;
    }

    .badge-soft {
      font-size: 11px;
      font-weight: 500;
      background: #ecfeff;
      color: #0e7490;
      border: 1px solid #67e8f9;
      padding: 2px 6px;
      border-radius: 6px;
      line-height: 1.2;
    }

    .panel-body {
      font-size: 13px;
      color: var(--text-main);
      line-height: 1.5;
    }

    /* ---------- RADIUS CONTROL ---------- */
    .radius-control {
      display: grid;
      grid-template-columns: 1fr;
      row-gap: 10px;
      font-size: 13px;
    }
    .radius-row {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 8px;
      font-size: 13px;
    }
    .radius-row label {
      font-size: 13px;
      font-weight: 500;
      color: var(--text-main);
    }
    .radius-row small {
      color: var(--text-dim);
      font-weight: 400;
    }
    .radius-inputs {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }
    .radius-inputs input[type="range"] {
      width: 140px;
    }
    .radius-number-wrap {
      background: #f0fdf4;
      border: 1px solid #86efac;
      border-radius: 8px;
      padding: 6px 8px;
      display: flex;
      align-items: baseline;
      gap: 4px;
      box-shadow: 0 16px 24px rgb(0 0 0 / 0.04);
    }
    .radius-number-wrap input[type="number"] {
      width: 60px;
      border: 0;
      background: transparent;
      color: var(--text-main);
      font-size: 14px;
      font-weight: 600;
      outline: none;
    }
    .radius-unit {
      font-size: 12px;
      color: var(--text-dim);
      white-space: nowrap;
    }

    /* ---------- CATEGORY FILTER ---------- */
    .cat-filter-wrap {
      font-size: 13px;
      line-height: 1.4;
      display: grid;
      row-gap: 10px;
    }

    .cat-filter-head {
      font-weight: 500;
      color: var(--text-main);
      font-size: 13px;
    }
    .cat-filter-hint {
      font-size: 12px;
      color: var(--text-dim);
      line-height: 1.4;
    }

    .cat-list {
      background: #fff;
      border: 1px solid var(--border-card);
      border-radius: var(--radius-md);
      padding: 12px;
      max-height: 140px;
      overflow-y: auto;
      box-shadow: inset 0 0 8px rgb(0 0 0 / .03);
      display: grid;
      row-gap: 8px;
      font-size: 13px;
    }
    .cat-row {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      font-size: 13px;
    }
    .cat-row input[type="checkbox"] {
      margin-top: 2px;
    }

    /* ---------- RESULT LIST ---------- */
    .result-box {
      background: #fff;
      border: 1px solid var(--border-card);
      border-radius: var(--radius-md);
      padding: 12px;
      max-height: 220px;
      overflow-y: auto;
      box-shadow: inset 0 0 8px rgb(0 0 0 / .03);
      font-size: 12px;
      line-height: 1.4;
      color: var(--text-main);
    }
    .result-box .res-head {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 6px;
      color: var(--text-main);
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .result-box ul {
      margin: 0;
      padding-left: 18px;
    }
    .result-box li {
      margin-bottom: 4px;
    }
    .res-distance {
      color: var(--text-dim);
      font-size: 12px;
      white-space: nowrap;
    }

    /* ---------- LEGEND ---------- */
    .legend-box {
      font-size: 12px;
      line-height: 1.4;
      color: var(--text-main);
      display: grid;
      row-gap: 6px;
    }

    .legend-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .legend-dot {
      width: 16px;
      height: 16px;
      border-radius: 999px;
      border: 2px solid #fff;
      box-shadow: 0 8px 16px rgb(0 0 0 / .2);
      flex-shrink: 0;
    }

    @media (max-width: 900px) {
      main.page {
        grid-template-columns: 1fr;
        grid-template-rows: auto auto;
        height: auto;
        max-height: none;
      }
      section.map-area {
        border-right: none;
        border-bottom: 1px solid var(--border-card);
        max-height: 60vh;
      }
      .map-wrapper {
        min-height: 280px;
      }
    }
  </style>
</head>
<body>

  <!-- HEADER / NAV -->
  <header class="site-header">
    <div class="brand-block">
      <div class="brand-title">
        <span>‚öîÔ∏è ‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á & ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏£‡∏±‡∏®‡∏°‡∏µ</span>
      </div>
      <div class="brand-sub">
        ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô ‚Üí ‡∏ß‡∏≤‡∏î‡∏£‡∏±‡∏®‡∏°‡∏µ‡∏à‡∏≤‡∏Å‡∏à‡∏∏‡∏î‡∏•‡∏≤‡∏ô‡πÄ‡∏£‡∏≤ ‚Üí ‡∏î‡∏π‡∏ß‡πà‡∏≤‡πÉ‡∏Ñ‡∏£‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏Å‡∏•‡πâ / ‡πÉ‡∏Ñ‡∏£‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á‡∏ï‡∏£‡∏á
      </div>
    </div>

    <nav class="main-nav">
      <a href="index.html"><span class="emoji">üè†</span><span>‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</span></a>
      <a href="map.html"><span class="emoji">üó∫Ô∏è</span><span>‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</span></a>
      <a href="competition.html" class="active"><span class="emoji">‚öîÔ∏è</span><span>‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á&‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</span></a>
      <a href="logistics.html"><span class="emoji">üöö</span><span>‡∏Å‡∏≤‡∏£‡∏Ç‡∏ô‡∏™‡πà‡∏á</span></a>
      <a href="population.html"><span class="emoji">üë•</span><span>‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£</span></a>
      <a href="supply.html"><span class="emoji">‚ôªÔ∏è</span><span>‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span></a>
      <a href="capacity.html"><span class="emoji">üè≠</span><span>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</span></a>
      <a href="risk.html"><span class="emoji">üö®</span><span>‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á</span></a>
    </nav>
  </header>

  <main class="page">

    <!-- ===== LEFT: MAP ===== -->
    <section class="map-area">

      <div class="map-head">
        <div class="map-head-left">
          <h1>
            <span>üó∫Ô∏è ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏®‡∏°‡∏µ‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á / ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</span>
          </h1>
          <div class="hint">
            ‡∏à‡∏∏‡∏î‡∏™‡πâ‡∏° = ‡∏à‡∏∏‡∏î‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏≤ (‡∏•‡∏≤‡∏ô‡∏Å‡∏£‡∏∞‡∏ó‡∏¥‡∏á‡πÅ‡∏î‡∏á)<br/>
            ‡∏ß‡∏á‡∏Å‡∏•‡∏° = ‡∏£‡∏±‡∏®‡∏°‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå (‡∏Å‡∏°.)<br/>
            ‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏™‡∏µ‡∏ï‡πà‡∏≤‡∏á ‡πÜ = ‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏£‡∏µ‡πÑ‡∏ã‡πÄ‡∏Ñ‡∏¥‡∏• / ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ / ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ
          </div>
        </div>
      </div>

      <div class="map-wrapper">
        <div id="map"></div>
      </div>
    </section>

    <!-- ===== RIGHT: CONTROL / RESULT ===== -->
    <aside class="side-panel">

      <!-- Radius control -->
      <section class="panel-card">
        <div class="panel-head">
          <div class="panel-title">
            <span>üìè ‡∏£‡∏±‡∏®‡∏°‡∏µ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</span>
            <span class="badge-soft">‡∏Å‡∏°. ‡∏à‡∏≤‡∏Å‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏≤</span>
          </div>
        </div>

        <div class="panel-body radius-control">
          <div class="radius-row">
            <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏¢‡∏∞</label>
            <small>(0.5 - 20 ‡∏Å‡∏°.)</small>
          </div>

          <div class="radius-inputs">
            <input id="radiusRange" type="range" min="0.5" max="20" step="0.5" value="5" />
            <div class="radius-number-wrap">
              <input id="radiusNumber" type="number" min="0.5" max="20" step="0.5" value="5" />
              <div class="radius-unit">‡∏Å‡∏°.</div>
            </div>
          </div>
          <div style="font-size:12px;color:var(--text-dim);line-height:1.4;">
            ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏£‡∏±‡∏®‡∏°‡∏µ‡∏ô‡∏µ‡πâ ‡πÅ‡∏•‡∏∞‡πÇ‡∏ä‡∏ß‡πå‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏à‡∏£‡∏¥‡∏á (‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏ö‡∏ö‡πÄ‡∏™‡πâ‡∏ô‡∏ï‡∏£‡∏á)
          </div>
        </div>
      </section>

      <!-- Category filter -->
      <section class="panel-card">
        <div class="panel-head">
          <div class="panel-title">
            <span>üè∑Ô∏è ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡∏î‡∏π</span>
            <span class="badge-soft">‡∏ï‡∏¥‡πä‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏≠‡∏±‡∏ô</span>
          </div>
        </div>

        <div class="panel-body cat-filter-wrap">
          <div class="cat-filter-head">
            ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô
          </div>
          <div class="cat-filter-hint">
            ‚Ä¢ ‚Äú‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏£‡∏µ‡πÑ‡∏ã‡πÄ‡∏Ñ‡∏¥‡∏•‚Äù = ‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á‡∏£‡∏±‡∏ö‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤ / ‡∏£‡∏µ‡πÑ‡∏ã‡πÄ‡∏Ñ‡∏¥‡∏•‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á<br/>
            ‚Ä¢ ‚Äú‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏™‡∏∏‡∏£‡∏≤‚Äù ‡πÄ‡∏£‡∏≤‡πÅ‡∏¢‡∏Å‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏´‡∏≤‡∏Å (‡∏Ç‡∏ß‡∏î‡πÅ‡∏Å‡πâ‡∏ß‡∏Ñ‡∏∑‡∏≠ supply ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏°‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤)
          </div>

          <div class="cat-list" id="categoryList">
            <!-- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Å‡∏ö‡πá‡∏≠‡∏Å‡∏ã‡πå‡∏ú‡πà‡∏≤‡∏ô JS -->
          </div>
        </div>
      </section>

      <!-- Result in radius -->
      <section class="panel-card">
        <div class="panel-head">
          <div class="panel-title">
            <span>üìç ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô‡∏£‡∏±‡∏®‡∏°‡∏µ</span>
          </div>
        </div>

        <div class="panel-body">
          <div class="result-box">
            <div class="res-head">
              üß≠ ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞ <span id="currentRadiusLabel">5.0</span> ‡∏Å‡∏°.
            </div>
            <ul id="resultList">
              <!-- ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠+‡∏£‡∏∞‡∏¢‡∏∞ ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢ JS -->
            </ul>
          </div>

          <div style="font-size:12px;color:var(--text-dim);line-height:1.4;margin-top:8px;">
            ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏Å‡∏•‡πâ = ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏ï‡πà‡∏≥ / ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏ß‡∏î‡πÑ‡∏ß<br/>
            ‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á‡πÉ‡∏Å‡∏•‡πâ = ‡πÄ‡∏Ç‡∏≤‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏£‡∏±‡∏ö‡∏ã‡∏∑‡πâ‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏≤
          </div>
        </div>
      </section>

      <!-- Legend -->
      <section class="panel-card">
        <div class="panel-head">
          <div class="panel-title">
            <span>üñçÔ∏è ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏™‡∏µ‡∏´‡∏°‡∏∏‡∏î</span>
          </div>
        </div>

        <div class="panel-body">
          <div class="legend-box">
            <div class="legend-row">
              <div class="legend-dot" style="background:var(--hub-color);border-color:#fff;"></div>
              <div><strong>‡∏à‡∏∏‡∏î‡∏•‡∏≤‡∏ô‡πÄ‡∏£‡∏≤</strong> (Hub)</div>
            </div>
            <div class="legend-row">
              <div class="legend-dot" style="background:var(--recycle-color);border-color:#fff;"></div>
              <div><strong>‡∏£‡∏µ‡πÑ‡∏ã‡πÄ‡∏Ñ‡∏¥‡∏•</strong> / ‡∏£‡∏±‡∏ö‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤ = ‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á‡∏´‡∏•‡∏±‡∏Å</div>
            </div>
            <div class="legend-row">
              <div class="legend-dot" style="background:var(--liquor-color);border-color:#fff;"></div>
              <div><strong>‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏™‡∏∏‡∏£‡∏≤</strong> = ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÅ‡∏Å‡πâ‡∏ß reuse</div>
            </div>
            <div class="legend-row">
              <div class="legend-dot" style="background:var(--other-color);border-color:#fff;"></div>
              <div><strong>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤/‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏≠‡∏∑‡πà‡∏ô</strong> (‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© / ‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å / ‡∏Ø‡∏•‡∏Ø)</div>
            </div>
          </div>
        </div>
      </section>

    </aside>
  </main>

  <script>
    // ---------------------------
    // CSV parser (‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö map.html ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ)
    // ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ü‡∏≠‡∏£‡πå‡πÅ‡∏°‡∏ï:
    // category,name,detail,"address with ,",lat,lng
    // ---------------------------
    function parseFactoriesCSV(csvText) {
      const lines = csvText.trim().split('\n');
      const arr = [];

      let startIndex = 0;
      const firstLower = lines[0].toLowerCase();
      const hasHeader =
        firstLower.includes('category') ||
        firstLower.includes('name') ||
        firstLower.includes('lat');
      if (hasHeader) startIndex = 1;

      for (let i = startIndex; i < lines.length; i++) {
        let row = lines[i].trim();
        if (!row) continue;

        // ‡πÄ‡∏Å‡πá‡∏ö address ‡∏à‡∏≤‡∏Å "...."
        let address = '';
        const addressMatch = row.match(/"([^"]*)"/);
        if (addressMatch) {
          address = addressMatch[1].trim();
          row = row.replace(addressMatch[0], '##ADDRESS_PLACEHOLDER##');
        }

        const parts = row.split(',').map(p => p.trim());
        if (parts.length < 6) continue;

        const categoryRaw = parts[0] || '';
        const name = parts[1] || '';
        const detail = parts[2] || '';

        let addressRebuild = parts[3];
        if (addressRebuild === '##ADDRESS_PLACEHOLDER##') {
          addressRebuild = address;
        }

        const lat = parseFloat(parts[4]);
        const lng = parseFloat(parts[5]);
        if (isNaN(lat) || isNaN(lng)) continue;

        // ---- logic ‡πÅ‡∏¢‡∏Å "‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏™‡∏∏‡∏£‡∏≤" ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏© ----
        // ‡∏™‡∏°‡∏°‡∏ï‡∏¥: ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ "‡∏™‡∏∏‡∏£‡∏≤" ‡πÉ‡∏ô name ‡∏´‡∏£‡∏∑‡∏≠ detail => ‡∏à‡∏±‡∏î‡∏´‡∏°‡∏ß‡∏î‡πÄ‡∏õ‡πá‡∏ô "‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏™‡∏∏‡∏£‡∏≤"
        // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà ‡∏Å‡πá‡πÉ‡∏ä‡πâ categoryRaw ‡∏õ‡∏Å‡∏ï‡∏¥
        let mainCategory = categoryRaw;
        const textForCheck = (name + " " + detail).toLowerCase();
        if (textForCheck.includes("‡∏™‡∏∏‡∏£‡∏≤")) {
          mainCategory = "‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏™‡∏∏‡∏£‡∏≤";
        }

        arr.push({
          category: categoryRaw,
          mainCategory, // ‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠‡∏´‡∏°‡∏ß‡∏î‡πÇ‡∏ä‡∏ß‡πå / filter
          name,
          detail,
          address: addressRebuild,
          lat,
          lng
        });
      }

      return arr;
    }

    // ‡∏à‡∏∏‡∏î‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡πÄ‡∏£‡∏≤ (Hub)
    const hub = {
      name: "‡∏•‡∏≤‡∏ô‡∏Å‡∏£‡∏∞‡∏ó‡∏¥‡∏á‡πÅ‡∏î‡∏á (Hub ‡πÄ‡∏£‡∏≤)",
      address: "‡∏ñ‡∏ô‡∏ô‡∏™‡∏≤‡∏¢‡πÉ‡∏¢‡∏£‡∏±‡∏Å ‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏≤‡∏Ñ‡∏£",
      lat: 13.565126,
      lng: 100.279895
    };

    // ‡∏Å‡∏•‡∏±‡∏ß‡πÉ‡∏ä‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á:
    function isRecycleFactory(f) {
      return f.mainCategory.includes("‡∏£‡∏µ‡πÑ‡∏ã‡πÄ‡∏Ñ‡∏¥‡∏•"); // ‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á‡∏´‡∏•‡∏±‡∏Å
    }

    // Map globals
    let map;
    let streetLayer;
    let markersLayer;
    let circleLayer;

    // Data globals
    let factories = [];
    let categoriesSet = new Set(); // ‡∏£‡∏≤‡∏¢‡∏´‡∏°‡∏ß‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    let selectedCategories = new Set(); // ‡∏£‡∏≤‡∏¢‡∏´‡∏°‡∏ß‡∏î‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡πä‡∏Å‡∏≠‡∏¢‡∏π‡πà

    // DOM refs
    const radiusRange  = document.getElementById("radiusRange");
    const radiusNumber = document.getElementById("radiusNumber");
    const currentRadiusLabel = document.getElementById("currentRadiusLabel");
    const categoryListBox = document.getElementById("categoryList");
    const resultList = document.getElementById("resultList");

    // ---------------------------
    // haversine ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á (‡∏Å‡∏°.)
    // ---------------------------
    function distanceKm(lat1, lon1, lat2, lon2) {
      const R = 6371; // km
      const dLat = (lat2-lat1) * Math.PI/180;
      const dLon = (lon2-lon1) * Math.PI/180;
      const a =
        Math.sin(dLat/2) * Math.sin(dLat/2) +
        Math.cos(lat1*Math.PI/180) * Math.cos(lat2*Math.PI/180) *
        Math.sin(dLon/2) * Math.sin(dLon/2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      return R * c;
    }

    // ---------------------------
    // ‡∏™‡∏£‡πâ‡∏≤‡∏á / ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏´‡∏°‡∏∏‡∏î‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏≤‡∏°‡∏£‡∏±‡∏®‡∏°‡∏µ‡πÅ‡∏•‡∏∞‡∏´‡∏°‡∏ß‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    // ---------------------------
    function renderMapAndList() {
      const r = parseFloat(radiusNumber.value) || 5;
      currentRadiusLabel.textContent = r.toFixed(1);

      // ‡∏•‡πâ‡∏≤‡∏á‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏î‡∏¥‡∏°
      markersLayer.clearLayers();
      if (circleLayer) {
        map.removeLayer(circleLayer);
      }

      // ‡∏ß‡∏≤‡∏î‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏£‡∏±‡∏®‡∏°‡∏µ
      circleLayer = L.circle([hub.lat, hub.lng], {
        radius: r * 1000,
        color: "#0ea5e9",
        weight: 2,
        fillColor: "#0ea5e9",
        fillOpacity: 0.07
      }).addTo(map);

      // ‡∏£‡∏ß‡∏°‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏≥‡πÑ‡∏õ‡πÇ‡∏ä‡∏ß‡πå‡πÉ‡∏ô list
      const insideList = [];

      factories.forEach(f => {
        // ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
        if (!selectedCategories.has(f.mainCategory)) return;

        const dist = distanceKm(hub.lat, hub.lng, f.lat, f.lng);
        if (dist <= r) {
          insideList.push({
            ...f,
            dist
          });

          // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏µ‡∏´‡∏°‡∏∏‡∏î
          let fillC = "var(--other-color)";
          let fillHex = getComputedStyle(document.documentElement)
              .getPropertyValue('--other-color')
              .trim();

          if (f.mainCategory === "‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏™‡∏∏‡∏£‡∏≤") {
            fillHex = getComputedStyle(document.documentElement)
              .getPropertyValue('--liquor-color')
              .trim();
          }
          if (isRecycleFactory(f)) {
            fillHex = getComputedStyle(document.documentElement)
              .getPropertyValue('--recycle-color')
              .trim();
          }

          const marker = L.circleMarker([f.lat, f.lng], {
            radius: 6,
            color: "#fff",
            weight: 1.5,
            fillColor: fillHex,
            fillOpacity: 0.9
          }).bindPopup(`
            <div style="font-size:14px;font-weight:600;color:#0f172a;line-height:1.4;margin-bottom:4px;">
              ${f.name || "-"}
            </div>
            <div style="font-size:12px;color:#475569;line-height:1.4;">
              <div><strong>‡∏´‡∏°‡∏ß‡∏î:</strong> ${f.mainCategory || "-"}</div>
              <div><strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</strong> ${f.detail || "-"}</div>
              <div><strong>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</strong> ${f.address || "-"}</div>
              <div><strong>‡∏£‡∏∞‡∏¢‡∏∞:</strong> ${dist.toFixed(2)} ‡∏Å‡∏°.</div>
              <div><strong>‡∏û‡∏¥‡∏Å‡∏±‡∏î:</strong> ${f.lat.toFixed(5)}, ${f.lng.toFixed(5)}</div>
            </div>
          `);

          marker.addTo(markersLayer);
        }
      });

      // ‡∏ß‡∏≤‡∏î‡∏´‡∏°‡∏∏‡∏î‡∏Æ‡∏±‡∏ö‡πÄ‡∏£‡∏≤ (‡∏ó‡∏±‡∏ö‡πÑ‡∏õ‡∏≠‡∏µ‡∏Å‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡∏°‡∏±‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡∏™‡∏∏‡∏î)
      const hubColor = getComputedStyle(document.documentElement)
        .getPropertyValue('--hub-color')
        .trim();

      const hubMarker = L.circleMarker([hub.lat, hub.lng], {
        radius: 10,
        color: "#fff",
        weight: 2,
        fillColor: hubColor,
        fillOpacity: 0.95
      }).bindPopup(`
        <div style="font-size:14px;font-weight:600;color:#0f172a;line-height:1.4;margin-bottom:4px;">
          ‚òÖ ${hub.name}
        </div>
        <div style="font-size:12px;color:#475569;line-height:1.4;">
          <div><strong>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</strong> ${hub.address}</div>
          <div><strong>‡∏û‡∏¥‡∏Å‡∏±‡∏î:</strong> ${hub.lat}, ${hub.lng}</div>
        </div>
      `);

      hubMarker.addTo(markersLayer);

      // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏•‡∏¥‡∏™‡∏ï‡πå‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡∏ß‡∏≤
      insideList.sort((a,b)=>a.dist-b.dist);

      resultList.innerHTML = insideList.map(item => {
        return `
          <li>
            <strong>${item.name || "-"}</strong>
            <span class="res-distance">(${item.dist.toFixed(2)} ‡∏Å‡∏°.)</span><br/>
            <span style="color:#475569;">${item.mainCategory || "-"}</span>
          </li>
        `;
      }).join("");
    }

    // ---------------------------
    // ‡∏™‡∏£‡πâ‡∏≤‡∏á checkbox filter ‡∏Ç‡∏≠‡∏á‡∏´‡∏°‡∏ß‡∏î
    // ---------------------------
    function buildCategoryFilters() {
      // categoriesSet ‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏à‡∏≤‡∏Å factories (mainCategory)
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á DOM checkbox ‡∏ï‡∏≤‡∏°‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏°‡∏ß‡∏î
      const cats = Array.from(categoriesSet).sort((a,b)=>a.localeCompare(b,'th'));

      categoryListBox.innerHTML = cats.map(cat => {
        const id = "cat_" + cat.replace(/\s+/g,'_');
        const hintColor =
          cat === "‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏™‡∏∏‡∏£‡∏≤"
            ? "color:var(--liquor-color);font-weight:600;"
            : (cat.includes("‡∏£‡∏µ‡πÑ‡∏ã‡πÄ‡∏Ñ‡∏¥‡∏•")
                ? "color:var(--recycle-color);font-weight:600;"
                : "color:var(--other-color);font-weight:600;");
        return `
          <label class="cat-row" for="${id}">
            <input type="checkbox" id="${id}" data-cat="${cat}" checked />
            <div>
              <div style="${hintColor}">${cat}</div>
            </div>
          </label>
        `;
      }).join("");

      // ‡∏ï‡∏±‡πâ‡∏á selectedCategories ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô = ‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î
      selectedCategories = new Set(cats);

      // add listeners
      cats.forEach(cat => {
        const id = "cat_" + cat.replace(/\s+/g,'_');
        const cb = document.getElementById(id);
        cb.addEventListener("change", () => {
          if (cb.checked) {
            selectedCategories.add(cat);
          } else {
            selectedCategories.delete(cat);
          }
          renderMapAndList();
        });
      });
    }

    // ---------------------------
    // sync radius input range <-> number
    // ---------------------------
    function syncRadiusInputs(from) {
      if (from === "range") {
        radiusNumber.value = radiusRange.value;
      } else {
        // clamp
        const v = parseFloat(radiusNumber.value) || 5;
        if (v < 0.5) radiusNumber.value = 0.5;
        if (v > 20) radiusNumber.value = 20;
        radiusRange.value = radiusNumber.value;
      }
      renderMapAndList();
    }

    radiusRange.addEventListener("input", ()=>syncRadiusInputs("range"));
    radiusNumber.addEventListener("input", ()=>syncRadiusInputs("number"));

    // ---------------------------
    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
    // ---------------------------
    function initMap() {
      streetLayer = L.tileLayer(
        "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
        {
          maxZoom: 19,
          attribution: "&copy; OpenStreetMap contributors"
        }
      );

      map = L.map("map", {
        center: [hub.lat, hub.lng],
        zoom: 12,
        layers: [streetLayer],
      });

      markersLayer = L.layerGroup().addTo(map);

      // ‡∏ã‡∏π‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô hub ‡∏ä‡∏±‡∏î ‡πÜ
      map.setView([hub.lat, hub.lng], 12);

      renderMapAndList();
    }

    // ---------------------------
    // ‡πÇ‡∏´‡∏•‡∏î CSV ‚Üí ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° data
    // ---------------------------
    fetch("data/factories.csv", { cache: "no-store" })
      .then(res => res.text())
      .then(csvText => {
        factories = parseFactoriesCSV(csvText);

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á mainCategory (‡πÄ‡∏£‡∏≤ set ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô parser) -> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ã‡πá‡∏ï‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        factories.forEach(f => {
          categoriesSet.add(f.mainCategory);
        });

        initMap();
        buildCategoryFilters();
        renderMapAndList();
      })
      .catch(err => {
        console.error("‡πÇ‡∏´‡∏•‡∏î factories.csv ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ:", err);
        alert("‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô (factories.csv)");
      });
  </script>
</body>
</html>
