<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á & ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏Å‡∏•‡πâ‡∏à‡∏∏‡∏î‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á - ‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏≤‡∏Ñ‡∏£</title>

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />

  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <style>
    :root {
      --bg-page: #ffffff;
      --bg-card: #ffffff;
      --border-card: #e2e8f0;
      --text-main: #0f172a;
      --text-dim: #475569;
      --text-subtle: #94a3b8;
      --brand-orange: #f97316;
      --brand-red: #dc2626;
      --brand-blue: #2563eb;
      --brand-amber: #f59e0b;
      --radius-lg: 16px;
      --radius-md: 12px;
      --radius-sm: 8px;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        Roboto, "Helvetica Neue", Arial, "Noto Sans Thai", sans-serif;
      background: var(--bg-page);
      color: var(--text-main);
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* HEADER / NAV (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô map.html) */
    header {
      background: #ffffff;
      border-bottom: 1px solid var(--border-card);
      padding: 12px 16px;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      row-gap: 10px;
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .brand {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-main);
      line-height: 1.4;
    }

    nav {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      font-size: 13px;
    }

    nav a {
      display: flex;
      align-items: center;
      gap: 6px;
      background: #ffffff;
      color: var(--text-dim);
      text-decoration: none;
      padding: 6px 10px;
      line-height: 1.2;
      border-radius: var(--radius-sm);
      border: 1px solid transparent;
      white-space: nowrap;
    }

    nav a.active {
      color: var(--text-main);
      border: 1px solid var(--border-card);
      background: #f8fafc;
      font-weight: 600;
    }

    nav a:hover {
      background: #f8fafc;
      color: var(--text-main);
      border: 1px solid var(--border-card);
    }

    .nav-icon {
      font-size: 14px;
      line-height: 1;
    }

    /* INTRO BLOCK */
    .page-intro-wrap {
      background: #ffffff;
      border-bottom: 1px solid var(--border-card);
      color: var(--text-main);
      padding: 12px 16px 10px;
    }

    .page-headline {
      font-size: 18px;
      font-weight: 600;
      line-height: 1.4;
      color: var(--text-main);
      display: flex;
      flex-wrap: wrap;
      align-items: baseline;
      gap: 8px;
      margin-bottom: 4px;
    }
    @media(min-width:768px){
      .page-headline { font-size:20px; }
    }

    .page-desc {
      font-size: 13px;
      line-height: 1.5;
      color: var(--text-dim);
      max-width: 1000px;
      margin: 0;
    }

    /* LAYOUT ‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ: ‡∏ã‡πâ‡∏≤‡∏¢ panel / ‡∏Ç‡∏ß‡∏≤ map */
    .content-wrap {
      flex: 1 1 auto;
      min-height: calc(100vh - 200px);
      display: flex;
      flex-direction: row;
      background: var(--bg-page);
    }

    /* SIDEBAR */
    .sidebar {
      width: 360px;
      max-width: 100%;
      border-right: 1px solid var(--border-card);
      background: var(--bg-page);
      display: flex;
      flex-direction: column;
      row-gap: 12px;
      padding: 16px;
      box-sizing: border-box;
    }

    .card {
      background: var(--bg-card);
      border: 1px solid var(--border-card);
      border-radius: var(--radius-md);
      box-shadow: 0 12px 24px rgb(15 23 42 / 0.04);
      padding: 16px 16px 12px;
      font-size: 13px;
      line-height: 1.5;
      color: var(--text-main);
    }

    .card:not(:last-child){
      margin-bottom: 4px;
    }

    .card-header {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-main);
      display: flex;
      align-items: baseline;
      gap: 8px;
      margin-bottom: 8px;
      line-height: 1.4;
    }
    .card-header .emoji {
      font-size: 16px;
      line-height: 1;
    }

    .hint {
      font-size: 12px;
      color: var(--text-dim);
      line-height: 1.5;
      margin-bottom: 12px;
    }

    /* form rows */
    .form-row {
      margin-bottom: 12px;
    }

    .label-topline {
      font-size: 13px;
      color: var(--text-main);
      font-weight: 500;
      line-height: 1.4;
      margin-bottom: 4px;
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 4px;
    }
    .label-topline small {
      color: var(--text-subtle);
      font-weight: 400;
      font-size: 12px;
    }

    .radius-value {
      font-weight: 600;
      color: var(--brand-orange);
    }

    input[type="range"] {
      width: 100%;
    }

    /* checkbox list */
    .checkbox-group {
      border: 1px solid var(--border-card);
      border-radius: var(--radius-sm);
      background: #f8fafc;
      padding: 8px 12px;
      max-height: 120px;
      overflow-y: auto;
    }
    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      line-height: 1.4;
      color: var(--text-main);
      margin-bottom: 6px;
    }
    .checkbox-item:last-child { margin-bottom: 0; }

    /* competitor list */
    .list-competitors {
      background: #fff1f2;
      border: 1px solid #fecdd3;
      border-radius: var(--radius-sm);
      padding: 12px;
      color: #b91c1c;
      max-height: 180px;
      overflow-y: auto;
      font-size: 13px;
      line-height: 1.45;
    }
    .list-competitors ul {
      padding-left: 20px;
      margin: 0;
    }
    .list-competitors li {
      margin-bottom: 4px;
    }

    .analysis-card {
      background: #f8fafc;
      border: 1px solid var(--border-card);
      border-radius: var(--radius-sm);
      padding: 12px;
      font-size: 12px;
      line-height: 1.5;
      color: var(--text-dim);
    }
    .analysis-card strong {
      color: var(--text-main);
      font-weight: 600;
    }

    /* MAP AREA */
    .map-area {
      position: relative;
      flex: 1 1 auto;
      min-height: 400px;
      background: #0f172a;
    }

    #map {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
    }

    /* leaflet popup */
    .leaflet-popup-content-wrapper {
      background:#1e293b;
      color:#f8fafc;
      border-radius:12px;
      border:1px solid #475569;
      box-shadow:0 20px 60px rgb(0 0 0 / .8);
    }
    .leaflet-popup-tip {
      background:#1e293b;
      border:1px solid #475569;
    }
    .popup-title {
      font-size:14px;
      font-weight:600;
      color:#fff;
      margin-bottom:4px;
      line-height:1.4;
    }
    .popup-desc {
      font-size:12px;
      color:#cbd5e1;
      line-height:1.4;
    }

    footer {
      border-top: 1px solid var(--border-card);
      background: #ffffff;
      color: var(--text-dim);
      font-size: 12px;
      text-align: center;
      padding: 16px;
      line-height: 1.4;
    }

    /* ‡∏™‡∏µ badge ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÉ‡∏ô sidebar */
    .dot-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      line-height: 1.3;
      color: var(--text-main);
      background: #f8fafc;
      border: 1px solid var(--border-card);
      border-radius: var(--radius-sm);
      padding: 4px 8px;
      margin-right: 6px;
      margin-bottom: 6px;
    }
    .dot {
      width: 14px;
      height: 14px;
      border-radius: 999px;
      border: 2px solid #fff;
      box-shadow: 0 4px 8px rgb(0 0 0 / .3);
    }
  </style>
</head>
<body>
  <!-- HEADER -->
  <header>
    <div class="brand">
      ‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏≤‡∏Ñ‡∏£ ¬∑ ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ Hub ‡∏£‡∏µ‡πÑ‡∏ã‡πÄ‡∏Ñ‡∏¥‡∏•‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î
    </div>
    <nav>
      <a href="index.html"><span class="nav-icon">üè†</span><span>‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</span></a>
      <a href="map.html"><span class="nav-icon">üó∫Ô∏è</span><span>‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</span></a>
      <a href="competition.html" class="active"><span class="nav-icon">‚öîÔ∏è</span><span>‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á</span></a>
      <a href="customers.html"><span class="nav-icon">ü§ù</span><span>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</span></a>
      <a href="population.html"><span class="nav-icon">üë•</span><span>‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£</span></a>
      <a href="forecast.html"><span class="nav-icon">üì¶</span><span>‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span></a>
      <a href="risk.html"><span class="nav-icon">üö¶</span><span>‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á</span></a>
    </nav>
  </header>

  <!-- INTRO -->
  <section class="page-intro-wrap">
    <div class="page-headline">
      ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏∏‡∏Å‡∏ï‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á / ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ‡∏£‡∏≠‡∏ö‡∏à‡∏∏‡∏î‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á‡πÄ‡∏£‡∏≤
    </div>
    <p class="page-desc">
      ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏¢‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå (‡∏Å‡∏°.) ‡πÅ‡∏•‡πâ‡∏ß‡∏î‡∏π‡∏ß‡πà‡∏≤‡πÉ‡∏ô‡∏£‡∏±‡∏®‡∏°‡∏µ‡∏£‡∏≠‡∏ö Hub
      ‡πÄ‡∏£‡∏≤‡∏°‡∏µ 1) ‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á‡∏£‡∏µ‡πÑ‡∏ã‡πÄ‡∏Ñ‡∏¥‡∏• (‡∏à‡∏∏‡∏î‡πÅ‡∏î‡∏á) 2) ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ ‡πÄ‡∏ä‡πà‡∏ô ‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© / ‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å / ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏° (‡∏à‡∏∏‡∏î‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡∏ó‡∏≠‡∏á)
      ‡πÅ‡∏•‡∏∞‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏≠‡∏∑‡πà‡∏ô (‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô) ‡∏°‡∏≤‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÅ‡∏Ñ‡πà‡πÑ‡∏´‡∏ô
      ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡∏ß‡∏≤‡∏à‡∏∞‡∏ß‡∏≤‡∏î‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏£‡∏∞‡∏¢‡∏∞ + ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏Ç‡∏ô‡∏™‡πà‡∏á‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡πâ‡∏î‡∏π
    </p>
  </section>

  <!-- MAIN CONTENT -->
  <section class="content-wrap">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <!-- ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏¢‡∏∞ + ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å -->
      <div class="card">
        <div class="card-header">
          <span class="emoji">üìè</span>
          <span>‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</span>
        </div>

        <div class="hint">
          ‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏±‡∏®‡∏°‡∏µ (‡∏Å‡∏°.) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÉ‡∏Ñ‡∏£‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏£‡∏≤‡∏ö‡πâ‡∏≤‡∏á
          ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏ô‡πÉ‡∏à (‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤)
        </div>

        <div class="form-row">
          <div class="label-topline">
            <span>‡∏£‡∏±‡∏®‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</span>
            <small><span id="radiusLabel" class="radius-value">5</span> ‡∏Å‡∏°.</small>
          </div>
          <input id="radiusInput" type="range" min="1" max="20" step="1" value="5" />
        </div>

        <div class="form-row">
          <div class="label-topline">
            <span>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô)</span>
            <small>‡∏ï‡∏¥‡πä‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡∏ä‡πà‡∏≠‡∏á‡πÑ‡∏î‡πâ</small>
          </div>

          <div class="checkbox-group" id="customerFilters">
            <label class="checkbox-item">
              <input type="checkbox" value="paper" checked />
              <span>‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© / ‡∏ö‡∏£‡∏£‡∏à‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" value="plastic" checked />
              <span>‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å / ‡πÄ‡∏°‡πá‡∏î‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å / PP / HDPE</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" value="beverage" checked />
              <span>‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏™‡∏∏‡∏£‡∏≤ / ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏° / ‡∏ö‡∏£‡∏£‡∏à‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÅ‡∏Å‡πâ‡∏ß</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" value="other" />
              <span>‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏≠‡∏∑‡πà‡∏ô ‡πÜ (‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ)</span>
            </label>
          </div>
        </div>

        <div class="form-row">
          <div class="label-topline">
            <span>‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå</span>
          </div>

          <div class="dot-badge">
            <span class="dot" style="background: var(--brand-red); border-color:#fff;"></span>
            <span>‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á‡∏£‡∏µ‡πÑ‡∏ã‡πÄ‡∏Ñ‡∏¥‡∏• / ‡∏à‡∏∏‡∏î‡∏£‡∏±‡∏ö‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤</span>
          </div>

          <div class="dot-badge">
            <span class="dot" style="background: var(--brand-amber); border-color:#fff;"></span>
            <span>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</span>
          </div>

          <div class="dot-badge">
            <span class="dot" style="background: var(--brand-blue); border-color:#fff;"></span>
            <span>‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏≠‡∏∑‡πà‡∏ô ‡πÜ / ‡∏≠‡∏∏‡∏ï‡∏™‡∏≤‡∏´‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</span>
          </div>

          <div class="dot-badge">
            <span class="dot" style="background: var(--brand-orange); border-color:#fff;"></span>
            <span>‡∏à‡∏∏‡∏î‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á‡πÄ‡∏£‡∏≤ (Hub)</span>
          </div>
        </div>
      </div>

      <!-- ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á‡πÉ‡∏ô‡∏£‡∏±‡∏®‡∏°‡∏µ -->
      <div class="card">
        <div class="card-header" style="color:var(--brand-red);">
          <span class="emoji">‚öîÔ∏è</span>
          <span>‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á‡πÉ‡∏ô‡∏£‡∏±‡∏®‡∏°‡∏µ</span>
        </div>

        <div class="list-competitors" id="competitorList">
          <ul>
            <li>...</li>
          </ul>
        </div>
      </div>

      <!-- ‡∏ö‡∏ó‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå -->
      <div class="card">
        <div class="card-header">
          <span class="emoji">üß†</span>
          <span>‡πÇ‡∏≠‡∏Å‡∏≤‡∏™ / ‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</span>
        </div>

        <div class="analysis-card" id="strategyBox">
          <strong>‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°:</strong> ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏™‡∏±‡πâ‡∏ô‡∏°‡∏µ ‚Äú‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‚Äù ‡πÄ‡∏¢‡∏≠‡∏∞‡∏Å‡∏ß‡πà‡∏≤ ‚Äú‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á‚Äù
          ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏à‡∏∏‡∏î‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ä‡∏¥‡∏á‡πÇ‡∏•‡∏à‡∏¥‡∏™‡∏ï‡∏¥‡∏Å‡∏™‡πå (‡∏Ç‡∏ô‡∏™‡∏±‡πâ‡∏ô ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≥)
          <br/><br/>
          <strong>‡∏£‡∏∞‡∏¢‡∏∞‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏™‡∏±‡πâ‡∏ô:</strong> ‡∏£‡∏±‡∏®‡∏°‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏∑‡∏≠ <span class="radius-value" id="radiusLabel2">5</span> ‡∏Å‡∏°.
          ‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡πÑ‡∏î‡πâ‡∏ß‡πà‡∏≤
          "‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏≠‡∏ö‡πÑ‡∏ã‡∏ï‡πå (Last-mile feedstock / last-mile pickup)"
          <br/><br/>
          <strong>‡∏≠‡∏¥‡∏ô‡∏û‡∏∏‡∏ï‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô:</strong> ‡∏ñ‡πâ‡∏≤‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© / ‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å / ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏° ‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô‡∏ï‡∏¥‡∏î‡πÑ‡∏ã‡∏ï‡πå
          ‡πÅ‡∏õ‡∏•‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡∏≠‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡πá‡∏ö‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô (‚ÄúDemand ‡∏Ç‡∏≤‡∏¢‡∏ã‡∏≤‡∏Å‚Äù + ‚ÄúSupply ‡∏Ç‡∏¢‡∏∞‡∏£‡∏µ‡πÑ‡∏ã‡πÄ‡∏Ñ‡∏¥‡∏•‚Äù) ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ß‡∏¥‡πà‡∏á‡πÑ‡∏Å‡∏•
        </div>
      </div>
    </aside>

    <!-- MAP -->
    <section class="map-area">
      <div id="map"></div>
    </section>
  </section>

  <footer>
    ¬© ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏ö Hub ¬∑ ‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏≤‡∏Ñ‡∏£ ¬∑ Prototype
  </footer>

  <!-- SCRIPT -->
  <script>
    // ---------------------------
    // 0) ‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞ (‡∏Å‡∏°.)
    // ---------------------------
    function haversineKm(lat1, lon1, lat2, lon2) {
      const R = 6371; // km
      const toRad = d => d * Math.PI / 180;
      const dLat = toRad(lat2 - lat1);
      const dLon = toRad(lon2 - lon1);
      const a =
        Math.sin(dLat/2) * Math.sin(dLat/2) +
        Math.cos(toRad(lat1)) *
        Math.cos(toRad(lat2)) *
        Math.sin(dLon/2) *
        Math.sin(dLon/2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      return R * c;
    }

    // ---------------------------
    // 1) ‡∏à‡∏∏‡∏î‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à (Hub ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤)
    // ---------------------------
    const hubSite = {
      name: "‡∏à‡∏∏‡∏î‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á‡πÄ‡∏£‡∏≤ (‡∏•‡∏≤‡∏ô‡∏Å‡∏£‡∏∞‡∏ó‡∏¥‡∏á‡πÅ‡∏î‡∏á)",
      address: "‡∏ñ‡∏ô‡∏ô‡∏™‡∏≤‡∏¢‡πÉ‡∏¢‡∏£‡∏±‡∏Å ‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏≤‡∏Ñ‡∏£",
      lat: 13.565126,
      lng: 100.279895
    };

    // ---------------------------
    // 2) parse CSV -> factories[]
    //    format:
    //    category,name,detail,"address with ,",lat,lng
    // ---------------------------
    function parseFactoriesCSV(csvText) {
      const lines = csvText.trim().split("\n");
      const out = [];

      let startIndex = 0;
      const first = lines[0].toLowerCase();
      const hasHeader =
        first.includes("category") ||
        first.includes("name") ||
        first.includes("lat");
      if (hasHeader) startIndex = 1;

      for (let i = startIndex; i < lines.length; i++) {
        let row = lines[i].trim();
        if (!row) continue;

        // ‡∏´‡∏≤ address ‡πÉ‡∏ô "..."
        let address = "";
        const m = row.match(/"([^"]*)"/);
        if (m) {
          address = m[1].trim();
          row = row.replace(m[0], "##ADDRESS_PLACEHOLDER##");
        }

        const parts = row.split(",").map(p => p.trim());
        if (parts.length < 6) continue;

        const category = parts[0] || "";
        const name = parts[1] || "";
        const detail = parts[2] || "";
        let addrGuess = parts[3];
        if (addrGuess === "##ADDRESS_PLACEHOLDER##") {
          addrGuess = address;
        }

        const lat = parseFloat(parts[4]);
        const lng = parseFloat(parts[5]);
        if (isNaN(lat) || isNaN(lng)) continue;

        out.push({
          category,
          name,
          detail,
          address: addrGuess,
          lat,
          lng
        });
      }
      return out;
    }

    // ---------------------------
    // 3) ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏µ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á)
    //    - recycle   = ‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á (‡∏£‡∏µ‡πÑ‡∏ã‡πÄ‡∏Ñ‡∏¥‡∏•/‡∏£‡∏±‡∏ö‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤)
    //    - paper     = ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏Å‡∏•‡πà‡∏≠‡∏á/‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©
    //    - plastic   = ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å/PP/HDPE
    //    - beverage  = ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°/‡∏™‡∏∏‡∏£‡∏≤/‡πÅ‡∏Å‡πâ‡∏ß
    //    - other     = ‡∏≠‡∏∑‡πà‡∏ô‡πÜ
    // ---------------------------
    function classifyBizType(f) {
      const text = (f.category + " " + f.name + " " + f.detail).toLowerCase();

      if (text.includes("‡∏£‡∏µ‡πÑ‡∏ã‡πÄ‡∏Ñ‡∏¥‡∏•") || text.includes("‡∏£‡∏±‡∏ö‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤")) {
        return "recycle";
      }
      if (text.includes("‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©") || text.includes("paper") ||
          text.includes("‡∏Å‡∏•‡πà‡∏≠‡∏á") || text.includes("‡∏ö‡∏£‡∏£‡∏à‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå")) {
        return "paper";
      }
      if (text.includes("‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å") || text.includes("pp") ||
          text.includes("hdpe") || text.includes("‡πÄ‡∏°‡πá‡∏î‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å")) {
        return "plastic";
      }
      if (text.includes("‡∏™‡∏∏‡∏£‡∏≤") || text.includes("‡πÄ‡∏´‡∏•‡πâ‡∏≤") ||
          text.includes("‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°") || text.includes("‡πÄ‡∏ö‡∏µ‡∏¢‡∏£‡πå") ||
          text.includes("‡πÅ‡∏Å‡πâ‡∏ß")) {
        return "beverage";
      }
      return "other";
    }

    // ---------------------------
    // 4) popup content
    // ---------------------------
    function popupHTML(f, distKm) {
      return `
        <div class="popup-title">${f.name || "-"}</div>
        <div class="popup-desc">
          <div><strong>‡∏´‡∏°‡∏ß‡∏î:</strong> ${f.category || "-"}</div>
          <div><strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</strong> ${f.detail || "-"}</div>
          <div><strong>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</strong> ${f.address || "-"}</div>
          <div><strong>‡∏û‡∏¥‡∏Å‡∏±‡∏î:</strong> ${f.lat.toFixed(5)}, ${f.lng.toFixed(5)}</div>
          <div><strong>‡∏£‡∏∞‡∏¢‡∏∞‡∏à‡∏≤‡∏Å Hub:</strong> ~${distKm.toFixed(2)} ‡∏Å‡∏°.</div>
        </div>
      `;
    }

    // ---------------------------
    // 5) Leaflet map setup
    // ---------------------------
    let map;
    let allMarkers = [];    // ‡πÄ‡∏Å‡πá‡∏ö {layer, data, bizType}
    let hubMarker;
    let radiusCircle;
    let dashLines = [];     // ‡πÄ‡∏™‡πâ‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≤‡∏Å hub -> ‡∏à‡∏∏‡∏î‡πÉ‡∏ô‡∏£‡∏±‡∏®‡∏°‡∏µ

    function initMap() {
      const street = L.tileLayer(
        "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
        {
          maxZoom: 19,
          attribution: "&copy; OpenStreetMap contributors"
        }
      );

      map = L.map("map", {
        center: [hubSite.lat, hubSite.lng],
        zoom: 12,
        layers: [street]
      });

      // ‡∏à‡∏∏‡∏î Hub ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤
      hubMarker = L.circleMarker([hubSite.lat, hubSite.lng], {
        radius: 10,
        color: "#fb923c",
        fillColor: "#f97316",
        fillOpacity: 0.9,
        weight: 2
      }).bindPopup(`
        <div class="popup-title">‚òÖ ${hubSite.name}</div>
        <div class="popup-desc">
          <div><strong>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</strong> ${hubSite.address}</div>
          <div><strong>‡∏û‡∏¥‡∏Å‡∏±‡∏î:</strong> ${hubSite.lat}, ${hubSite.lng}</div>
        </div>
      `).addTo(map);

      // ‡∏ß‡∏á‡∏£‡∏±‡∏®‡∏°‡∏µ default (‡∏à‡∏∞ update ‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á)
      radiusCircle = L.circle([hubSite.lat, hubSite.lng], {
        radius: 5000, // m (5 km default)
        color: "#dc2626",
        fillColor: "#dc2626",
        fillOpacity: 0.08,
        weight: 2,
        dashArray: "4 4"
      }).addTo(map);
    }

    // ---------------------------
    // 6) render markers ‡∏à‡∏≤‡∏Å factories
    // ---------------------------
    function makeMarkerColor(bizType) {
      if (bizType === "recycle") return {fill:"#dc2626"};        // ‡πÅ‡∏î‡∏á
      if (bizType === "paper" || bizType==="plastic" || bizType==="beverage")
        return {fill:"#f59e0b"};                                // ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡∏ó‡∏≠‡∏á (‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤)
      if (bizType === "other") return {fill:"#2563eb"};         // ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô
      return {fill:"#2563eb"};
    }

    function makeMarker(f) {
      const bizType = classifyBizType(f);
      const dist = haversineKm(hubSite.lat, hubSite.lng, f.lat, f.lng);
      const colorObj = makeMarkerColor(bizType);

      const marker = L.circleMarker([f.lat, f.lng], {
        radius: 7,
        color: "#fff",
        weight: 1.5,
        fillColor: colorObj.fill,
        fillOpacity: 0.9
      }).bindPopup(popupHTML(f, dist));

      return { layer: marker, data: f, bizType };
    }

    // ---------------------------
    // 7) ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ï‡∏≤‡∏°‡∏£‡∏±‡∏®‡∏°‡∏µ / ‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á
    // ---------------------------
    function getSelectedCustomerTypes() {
      const box = document.getElementById("customerFilters");
      const checks = [...box.querySelectorAll("input[type=checkbox]")];
      const vals = checks.filter(c => c.checked).map(c => c.value);
      return new Set(vals); // ex. {"paper","plastic","beverage"}
    }

    function updateView() {
      const radiusKm = parseFloat(document.getElementById("radiusInput").value);
      document.getElementById("radiusLabel").textContent = radiusKm;
      document.getElementById("radiusLabel2").textContent = radiusKm;

      // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ß‡∏á‡∏Å‡∏•‡∏° (Leaflet ‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏ï‡∏£)
      radiusCircle.setRadius(radiusKm * 1000);

      // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÄ‡∏™‡πâ‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏Å‡πà‡∏≤
      dashLines.forEach(line => map.removeLayer(line));
      dashLines = [];

      // ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á‡πÉ‡∏ô panel
      const listBox = document.getElementById("competitorList");
      const ul = document.createElement("ul");

      const selectedTypes = getSelectedCustomerTypes();

      allMarkers.forEach(obj => {
        const dist = haversineKm(hubSite.lat, hubSite.lng, obj.data.lat, obj.data.lng);
        const inRadius = dist <= radiusKm;

        // ‡∏ï‡∏£‡∏£‡∏Å‡∏∞‡∏ã‡πà‡∏≠‡∏ô/‡πÇ‡∏ä‡∏ß‡πå:
        // - recycle (‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á) => ‡πÄ‡∏£‡∏≤‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏™‡∏°‡∏≠ (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏ß‡∏±‡∏á)
        // - ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (paper/plastic/beverage) => ‡πÅ‡∏™‡∏î‡∏á‡∏ñ‡πâ‡∏≤‡∏ñ‡∏π‡∏Å‡∏ï‡∏¥‡πä‡∏Å
        // - other => ‡πÅ‡∏™‡∏î‡∏á‡∏ñ‡πâ‡∏≤ user ‡∏ï‡∏¥‡πä‡∏Å "other"
        let showThis = false;
        if (obj.bizType === "recycle") {
          showThis = true;
        } else if (obj.bizType === "other") {
          showThis = selectedTypes.has("other");
        } else {
          // ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
          showThis = selectedTypes.has(obj.bizType);
        }

        if (showThis) {
          obj.layer.addTo(map);
        } else {
          map.removeLayer(obj.layer);
        }

        // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏±‡∏®‡∏°‡∏µ -> ‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏õ‡∏£‡∏∞ + ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á -> ‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô list
        if (inRadius && showThis) {
          const dashLine = L.polyline(
            [
              [hubSite.lat, hubSite.lng],
              [obj.data.lat, obj.data.lng]
            ],
            {
              color: "#1e3a8a",
              weight: 1,
              opacity: 0.6,
              dashArray: "4 4"
            }
          ).addTo(map);
          dashLines.push(dashLine);

          if (obj.bizType === "recycle") {
            const li = document.createElement("li");
            li.textContent = obj.data.name || "(‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠)";
            ul.appendChild(li);
          }
        }
      });

      // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á‡πÉ‡∏ô‡∏£‡∏±‡∏®‡∏°‡∏µ‡πÄ‡∏•‡∏¢
      if (!ul.children.length) {
        const li = document.createElement("li");
        li.textContent = "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á‡∏£‡∏µ‡πÑ‡∏ã‡πÄ‡∏Ñ‡∏¥‡∏•‡πÉ‡∏ô‡∏£‡∏±‡∏®‡∏°‡∏µ‡∏ô‡∏µ‡πâ";
        ul.appendChild(li);
      }

      listBox.innerHTML = "";
      listBox.appendChild(ul);
    }

    // ---------------------------
    // 8) ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• CSV ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    // ---------------------------
    let factoriesData = [];

    fetch("data/factories.csv", { cache: "no-store" })
      .then(r => r.text())
      .then(txt => {
        factoriesData = parseFactoriesCSV(txt);

        initMap();

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á marker ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
        factoriesData.forEach(f => {
          const mkp = makeMarker(f);
          allMarkers.push(mkp);
          // default ‡πÉ‡∏™‡πà‡∏•‡∏á map ‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏ô updateView()
        });

        // ‡πÄ‡∏£‡∏¥‡πà‡∏° render ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
        updateView();

        // ‡∏ú‡∏π‡∏Å event UI
        document.getElementById("radiusInput").addEventListener("input", updateView);
        document
          .getElementById("customerFilters")
          .addEventListener("change", updateView);

        // fit bounds ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô hub ‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á
        const bounds = L.latLngBounds([
          [hubSite.lat, hubSite.lng],
          ...factoriesData.map(f => [f.lat, f.lng])
        ]);
        map.fitBounds(bounds.pad(0.2));
      })
      .catch(err => {
        console.error("‡πÇ‡∏´‡∏•‡∏î factories.csv ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ:", err);
        alert("‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô (factories.csv)");
      });
  </script>
</body>
</html>
